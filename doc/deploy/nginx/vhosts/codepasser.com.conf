upstream codepasser-fe-mamba {
    server 127.0.0.1:7000;
}

upstream codepasser-fe-portal {
    server 127.0.0.1:7001;
}

upstream codepasser-fe-open {
    server 127.0.0.1:7002;
}

upstream codepasser-fe-search {
    server 127.0.0.1:7003;
}

upstream codepasser-daemon-gateway {
    server 127.0.0.1:8000;
}

upstream codepasser-daemon-web-api {
    server 127.0.0.1:8001;
}

upstream codepasser-daemon-web-oauth {
    server 127.0.0.1:8801;
}

upstream codepasser-daemon-web-cas {
    server 127.0.0.1:8802;
}

upstream codepasser-daemon-service-base {
    server 127.0.0.1:9001;
}

upstream codepasser-cas-service {
    server 172.16.20.121:8081;
}

server {
    listen          80;
    server_name     www.codepasser.com;
    charset         UTF-8;
    #access_log logs/codepasser.access.log  main;

    #listen          443 ssl;
    #ssl on;
    #ssl_certificate      ssl/daemon.crt;
    #ssl_certificate_key  ssl/daemon.key;

    #ssl_session_cache    shared:SSL:1m;
    #ssl_session_timeout  5m;

    #ssl_ciphers  HIGH:!aNULL:!MD5;
    #ssl_prefer_server_ciphers  on;

    # FE -> root
    location / {
        root deploy/codepasser/fe/root;
        try_files $uri $uri/ /index.html;
        index index.html index.htm;
    }

    # FE -> guide mamba
    location ^~ /mamba {
        alias deploy/codepasser/fe/mamba;
        try_files $uri $uri/ /mamba/index.html;
        index index.html index.htm;
    }

    # FE -> fe portal
    location ^~ /portal {
        alias deploy/codepasser/fe/portal;
        try_files $uri $uri/ /portal/index.html;
        index index.html index.htm;
    }

    # Daemon -> gateway
    location ^~ /gateway/ {
        proxy_redirect          off;
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Accept-Encoding 'gzip';
        proxy_pass              http://codepasser-daemon-gateway;
    }

    # Daemon -> web-api
    location ^~ /web-api/ {
        proxy_redirect          off;
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Accept-Encoding 'gzip';
        proxy_pass              http://codepasser-daemon-web-api;
    }

    # Daemon -> web-oauth
    location ^~ /web-oauth/ {
        proxy_redirect          off;
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Accept-Encoding 'gzip';
        proxy_pass              http://codepasser-daemon-web-oauth;
    }

    # Daemon -> web-cas
    location ^~ /web-cas/ {
        proxy_redirect          off;
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Accept-Encoding 'gzip';
        proxy_pass              http://codepasser-daemon-web-cas;
    }

    # Daemon -> service-base
    location ^~ /service-base/ {
        proxy_redirect          off;
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Accept-Encoding 'gzip';
        proxy_pass              http://codepasser-daemon-service;
    }

    # Storage
    location ^~ /storage/ {
        root /data;
        index index.html;
    }

    # Codepasser -> Cas server
    location ^~ /cas {
        proxy_redirect          off;
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Accept-Encoding 'gzip';
        proxy_pass              http://codepasser-cas-service;
    }
}
